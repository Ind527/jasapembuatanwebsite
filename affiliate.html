<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Affiliate | SitusKita</title>
    <meta name="description" content="Panel affiliate SitusKita - dapatkan komisi dari setiap referral yang berhasil">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
    <!-- Clerk Authentication -->
    <script
        async
        crossorigin="anonymous"
        data-clerk-publishable-key="pk_test_ZHluYW1pYy10YWhyLTk1LmNsZXJrLmFjY291bnRzLmRldiQ"
        src="https://dynamic-tahr-95.clerk.accounts.dev/npm/@clerk/clerk-js@5/dist/clerk.browser.js"
        type="text/javascript"
    ></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'jakarta': ['Plus Jakarta Sans', 'sans-serif'],
                        'manrope': ['Manrope', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#0EA5E9',
                        'primary-dark': '#0284C7',
                        'secondary': '#6366F1',
                        'text-dark': '#111111',
                        'text-light': '#64748B',
                        'bg-light': '#F8F8F8',
                    }
                }
            }
        }
    </script>
    
    <style>
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .btn-primary { background: #111111; color: white; transition: all 0.3s ease; }
        .btn-primary:hover { background: #333333; transform: translateY(-2px); }
        .btn-secondary { background: #0EA5E9; color: white; transition: all 0.3s ease; }
        .btn-secondary:hover { background: #0284C7; transform: translateY(-2px); }
        .text-gradient { background: linear-gradient(135deg, #0EA5E9, #6366F1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="font-manrope text-text-dark bg-bg-light">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white/95 backdrop-blur-sm z-50 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-jakarta font-bold text-gradient">SitusKita</a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="index.html" class="text-text-light hover:text-primary font-medium transition-colors">Beranda</a>
                        <a href="about.html" class="text-text-light hover:text-primary font-medium transition-colors">Tentang Kami</a>
                        <a href="services.html" class="text-text-light hover:text-primary font-medium transition-colors">Layanan</a>
                        <a href="portfolio.html" class="text-text-light hover:text-primary font-medium transition-colors">Portofolio</a>
                        <a href="pricing.html" class="text-text-light hover:text-primary font-medium transition-colors">Harga</a>
                        <a href="affiliate.html" class="text-primary font-medium transition-colors">Affiliate</a>
                        <a href="order-tracking.html" class="text-text-light hover:text-primary font-medium transition-colors">Pelacakan</a>
                        <a href="contact.html" class="btn-primary px-6 py-2 rounded-lg font-medium">Konsultasi Gratis</a>
                        <div id="user-button"></div>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-text-dark hover:text-primary">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="index.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Beranda</a>
                <a href="about.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Tentang Kami</a>
                <a href="services.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Layanan</a>
                <a href="portfolio.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Portofolio</a>
                <a href="pricing.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Harga</a>
                <a href="affiliate.html" class="block px-3 py-2 text-primary font-medium">Affiliate</a>
                <a href="order-tracking.html" class="block px-3 py-2 text-text-light hover:text-primary font-medium">Pelacakan</a>
                <a href="contact.html" class="block px-3 py-2 btn-primary rounded-lg font-medium text-center mt-4">Konsultasi Gratis</a>
                <!-- Mobile User Button (for logout) -->
                <div id="mobile-user-button" class="px-3 py-2"></div>
            </div>
        </div>
    </nav>

    <!-- Authentication Container -->
    <div id="auth" class="min-h-screen flex flex-col items-center justify-center pt-24 pb-16 px-4">
        <div class="text-center mb-8 max-w-2xl">
            <h1 class="text-4xl font-jakarta font-bold mb-4">
                Dashboard <span class="text-gradient">Affiliate</span>
            </h1>
            <p class="text-xl text-text-light">
                Silakan login untuk mengakses dashboard Anda
            </p>
        </div>
        <div id="clerk-signin-container" class="w-full max-w-md"></div>
    </div>

    <!-- Main Content (Protected) -->
    <main id="affiliate-content" class="pt-24 pb-16" style="display:none">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl lg:text-5xl font-jakarta font-bold mb-4">
                    Dashboard <span class="text-gradient">Affiliate</span>
                </h1>
                <p class="text-xl text-text-light max-w-2xl mx-auto">
                    Dapatkan komisi 10% dari setiap referral yang berhasil order website
                </p>
            </div>

            <!-- Referral Link Section -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-jakarta font-bold mb-6">Link Referral Anda</h2>
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl mb-4">
                    <label class="block text-sm font-medium text-text-light mb-2">Kode Affiliate Anda</label>
                    <div class="flex items-center gap-4 mb-4">
                        <input type="text" id="affiliate-code" readonly 
                            class="flex-1 px-4 py-3 bg-white border border-gray-300 rounded-lg font-mono text-lg font-semibold">
                        <button onclick="copyAffiliateCode()" 
                            class="btn-secondary px-6 py-3 rounded-lg font-medium whitespace-nowrap">
                            <i class="fas fa-copy mr-2"></i> Salin Kode
                        </button>
                    </div>
                    
                    <label class="block text-sm font-medium text-text-light mb-2 mt-6">Link Referral Lengkap</label>
                    <div class="flex items-center gap-4">
                        <input type="text" id="referral-link" readonly 
                            class="flex-1 px-4 py-3 bg-white border border-gray-300 rounded-lg text-sm">
                        <button onclick="copyReferralLink()" 
                            class="btn-primary px-6 py-3 rounded-lg font-medium whitespace-nowrap">
                            <i class="fas fa-link mr-2"></i> Salin Link
                        </button>
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="text-sm text-blue-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        Bagikan link referral Anda ke teman, keluarga, atau media sosial. Anda akan mendapatkan komisi 10% dari setiap pembelian yang menggunakan link Anda!
                    </p>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-8">
                <!-- Total Clicks -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 card-hover">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4">
                        <div class="bg-blue-100 p-2 sm:p-3 rounded-lg mb-2 sm:mb-0">
                            <i class="fas fa-mouse-pointer text-xl sm:text-2xl text-blue-600"></i>
                        </div>
                        <span class="text-xs sm:text-sm text-text-light">Total</span>
                    </div>
                    <h3 class="text-2xl sm:text-3xl font-bold mb-1 sm:mb-2" id="total-clicks">0</h3>
                    <p class="text-xs sm:text-base text-text-light">Total Klik</p>
                </div>

                <!-- Total Orders -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 card-hover">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4">
                        <div class="bg-green-100 p-2 sm:p-3 rounded-lg mb-2 sm:mb-0">
                            <i class="fas fa-shopping-cart text-xl sm:text-2xl text-green-600"></i>
                        </div>
                        <span class="text-xs sm:text-sm text-text-light">Sukses</span>
                    </div>
                    <h3 class="text-2xl sm:text-3xl font-bold mb-1 sm:mb-2" id="total-orders">0</h3>
                    <p class="text-xs sm:text-base text-text-light">Total Order</p>
                </div>

                <!-- Total Revenue -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 card-hover">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4">
                        <div class="bg-purple-100 p-2 sm:p-3 rounded-lg mb-2 sm:mb-0">
                            <i class="fas fa-wallet text-xl sm:text-2xl text-purple-600"></i>
                        </div>
                        <span class="text-xs sm:text-sm text-text-light">Revenue</span>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold mb-1 sm:mb-2" id="total-revenue">Rp 0</h3>
                    <p class="text-xs sm:text-base text-text-light">Total Revenue</p>
                </div>

                <!-- Total Commission -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 card-hover">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4">
                        <div class="bg-yellow-100 p-2 sm:p-3 rounded-lg mb-2 sm:mb-0">
                            <i class="fas fa-money-bill-wave text-xl sm:text-2xl text-yellow-600"></i>
                        </div>
                        <span class="text-xs sm:text-sm text-text-light">10%</span>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold mb-1 sm:mb-2" id="total-commission">Rp 0</h3>
                    <p class="text-xs sm:text-base text-text-light">Komisi (10%)</p>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-jakarta font-bold mb-6">Order dari Referral Anda</h2>
                <div id="orders-list" class="space-y-4">
                    <div class="text-center py-8 text-text-light">
                        <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
                        <p>Belum ada order dari referral Anda</p>
                    </div>
                </div>
            </div>

            <!-- How It Works -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl shadow-lg p-8 text-white">
                <h2 class="text-2xl font-jakarta font-bold mb-6 text-center">Cara Kerja Program Affiliate</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl font-bold">1</span>
                        </div>
                        <h3 class="font-bold mb-2">Bagikan Link</h3>
                        <p class="text-sm opacity-90">Salin dan bagikan link referral Anda ke teman, keluarga, atau media sosial</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl font-bold">2</span>
                        </div>
                        <h3 class="font-bold mb-2">Mereka Order</h3>
                        <p class="text-sm opacity-90">Ketika ada yang order melalui link Anda, kami akan mencatatnya</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl font-bold">3</span>
                        </div>
                        <h3 class="font-bold mb-2">Dapatkan Komisi</h3>
                        <p class="text-sm opacity-90">Anda mendapatkan komisi 10% dari nilai order yang berhasil</p>
                    </div>
                </div>
            </div>

            <!-- Demo Data Button -->
            <div class="text-center mt-8">
                <button onclick="generateDemoData()" 
                    class="text-text-light hover:text-primary text-sm font-medium">
                    <i class="fas fa-database mr-2"></i> Generate Data Demo
                </button>
                <button onclick="resetData()" 
                    class="ml-4 text-text-light hover:text-red-600 text-sm font-medium">
                    <i class="fas fa-trash mr-2"></i> Reset Data
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-text-dark text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 SitusKita. All rights reserved.</p>
        </div>
    </footer>

    <!-- Load Scripts -->
    <script src="affiliate.js"></script>
    <script src="dashboard.js"></script>
    <script src="admin-dashboard.js"></script>
    <script src="sales-dashboard.js"></script>
    <script src="clerk-auth.js"></script>
    <script src="main.js"></script>
    
    <script>
        // Display affiliate data on page load
        function displayAffiliateData() {
            const affiliateData = affiliateSystem.getAffiliateData();
            const clickStats = affiliateSystem.getClickStats();
            const orderStats = affiliateSystem.getOrderStats();
            
            if (affiliateData) {
                document.getElementById('affiliate-code').value = affiliateData.code;
                // Update referral link to point to contact page
                const referralLink = `${window.location.origin}/contact.html?ref=${affiliateData.code}`;
                document.getElementById('referral-link').value = referralLink;
            }
            
            // Display statistics
            document.getElementById('total-clicks').textContent = clickStats.total;
            document.getElementById('total-orders').textContent = orderStats.total;
            document.getElementById('total-revenue').textContent = formatCurrency(orderStats.totalRevenue || 0);
            document.getElementById('total-commission').textContent = formatCurrency(orderStats.totalCommission);
            
            // Display orders
            displayOrders(orderStats.orders);
        }
        
        function displayOrders(orders) {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-8 text-text-light">
                        <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
                        <p>Belum ada order dari referral Anda</p>
                    </div>
                `;
                return;
            }
            
            ordersList.innerHTML = orders.map(order => `
                <div class="border border-gray-200 rounded-lg p-4 hover:border-primary transition-colors">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-lg">${order.orderNumber}</p>
                            <p class="text-text-light text-sm">${new Date(order.timestamp).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-green-600">+${formatCurrency(order.commission)}</p>
                            <p class="text-text-light text-sm">dari ${formatCurrency(order.amount)}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function copyAffiliateCode() {
            const codeInput = document.getElementById('affiliate-code');
            codeInput.select();
            document.execCommand('copy');
            showNotification('Kode affiliate berhasil disalin!');
        }
        
        function copyReferralLink() {
            const linkInput = document.getElementById('referral-link');
            linkInput.select();
            document.execCommand('copy');
            showNotification('Link referral berhasil disalin!');
        }
        
        function generateDemoData() {
            affiliateSystem.generateDemoData();
            displayAffiliateData();
            showNotification('Data demo berhasil di-generate!');
        }
        
        function resetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data affiliate?')) {
                affiliateSystem.resetAffiliate();
                displayAffiliateData();
                showNotification('Data affiliate berhasil direset!');
            }
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', displayAffiliateData);
    </script>
</body>
</html>
